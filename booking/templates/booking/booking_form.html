{% extends "base.html" %}

{% block content %}
<div class="max-w-lg mx-auto mt-10 bg-white shadow-lg rounded-xl p-6">
  <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">Buat Booking Baru</h1>

  {% if lapangan_terpilih %}
  <div class="mb-6 bg-green-50 border border-green-200 rounded-lg p-4">
    <h2 class="text-lg font-semibold text-green-800">Lapangan yang Dipesan:</h2>
    <p class="text-gray-700 mt-1 font-medium">{{ lapangan_terpilih.nama }}</p>
    <p class="text-gray-600 text-sm">Harga per jam: <strong>Rp {{ lapangan_terpilih.harga_per_jam }}</strong></p>
  </div>
  {% endif %}

  <form id="bookingForm" class="space-y-5" method="post">
    {% csrf_token %}

    <!-- Hidden Lapangan -->
    <input type="hidden" id="id_lapangan" name="lapangan" value="{{ lapangan_terpilih.id_lapangan }}"
           data-harga="{{ lapangan_terpilih.harga_per_jam }}">

    <!-- Tanggal -->
    <div class="flex flex-col">
      <label for="id_tanggal" class="block text-gray-700 font-semibold mb-1">Tanggal</label>
      <input type="date" name="tanggal" id="id_tanggal" required
             class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-300">
    </div>

    <!-- Jam Mulai -->
    <div class="flex flex-col">
      <label for="id_jam_mulai" class="block text-gray-700 font-semibold mb-1">Jam Mulai</label>
      <select name="jam_mulai" id="id_jam_mulai" required
              class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-300">
        {% for i in jam_range %}
          <option value="{{ i }}">{{ i }}:00</option>
        {% endfor %}
      </select>
    </div>

    <!-- Jam Selesai -->
    <div class="flex flex-col">
      <label for="id_jam_selesai" class="block text-gray-700 font-semibold mb-1">Jam Selesai</label>
      <select name="jam_selesai" id="id_jam_selesai" required
              class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-300">
        {% for i in jam_range %}
          <option value="{{ i }}">{{ i }}:00</option>
        {% endfor %}
      </select>
    </div>

    <!-- Total Harga -->
    <div class="flex flex-col">
      <label for="id_total_harga" class="block text-gray-700 font-semibold mb-1">Total Harga</label>
      <input type="text" name="total_harga" id="id_total_harga" readonly
             class="border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed">
      <p class="text-sm text-gray-500 mt-1">Otomatis dihitung berdasarkan durasi sewa.</p>
    </div>

    <button type="submit"
      class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md transition">
      Simpan Booking
    </button>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const jamMulai = document.getElementById("id_jam_mulai");
  const jamSelesai = document.getElementById("id_jam_selesai");
  const totalHargaInput = document.getElementById("id_total_harga");
  const lapanganHidden = document.getElementById("id_lapangan");

  function hitungTotal() {
    const mulai = parseInt(jamMulai.value);
    const selesai = parseInt(jamSelesai.value);
    if (isNaN(mulai) || isNaN(selesai)) {
      totalHargaInput.value = "";
      return;
    }

    const durasi = selesai - mulai;
    if (durasi <= 0) {
      totalHargaInput.value = "Jam tidak valid";
      return;
    }

    const hargaPerJam = parseInt(lapanganHidden.dataset.harga);
    totalHargaInput.value = durasi * hargaPerJam;
  }

  [jamMulai, jamSelesai].forEach(el => el.addEventListener("change", hitungTotal));
});
</script>

<!-- âœ… SweetAlert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% endblock %}
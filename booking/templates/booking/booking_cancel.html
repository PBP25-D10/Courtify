{% extends "base.html" %}

{% block content %}
<div class="max-w-md mx-auto mt-16 bg-white shadow-lg rounded-2xl p-8 text-center border border-gray-200">
  <h1 class="text-2xl font-bold text-gray-800 mb-4">Batalkan Booking</h1>

  <p class="text-gray-700 mb-6">
    Apakah kamu yakin ingin membatalkan booking untuk
    <b class="text-blue-700">{{ booking.lapangan }}</b>
    pada <b>{{ booking.tanggal }}</b>?
  </p>

  <div class="flex justify-center space-x-3">
    <button id="btnCancel"
      data-id="{{ booking.id }}"
      class="bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-md transition">
      Ya, Batalkan
    </button>

    <a href="{% url 'booking:booking_list' %}"
      class="bg-gray-400 hover:bg-gray-500 text-white px-5 py-2 rounded-md transition">
      Kembali
    </a>
  </div>
</div>

<!-- CSRF -->
<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const btn = document.getElementById("btnCancel");
  const csrfToken = document.querySelector("input[name=csrfmiddlewaretoken]").value;
  const bookingId = btn.dataset.id;

  btn.addEventListener("click", function() {
    Swal.fire({
      title: "Yakin ingin membatalkan?",
      text: "Tindakan ini tidak dapat dibatalkan.",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#d33",
      cancelButtonColor: "#3085d6",
      confirmButtonText: "Ya, batalkan",
      cancelButtonText: "Batal"
    }).then((result) => {
      if (result.isConfirmed) {
        btn.disabled = true;
        btn.textContent = "Memproses...";

        fetch(`/booking/cancel/${bookingId}/`, {
          method: "POST",
          headers: {
            "X-CSRFToken": csrfToken,
            "X-Requested-With": "XMLHttpRequest",
          },
        })
        .then(response => response.json())
        .then(data => {
          btn.disabled = false;
          btn.textContent = "Ya, Batalkan";

          if (data.success) {
            Swal.fire({
              icon: "success",
              title: "Berhasil!",
              text: data.message || "Booking berhasil dibatalkan.",
              confirmButtonColor: "#2563eb"
            }).then(() => {
              window.location.href = "{% url 'booking:booking_list' %}";
            });
          } else {
            Swal.fire("Gagal", data.error || "Tidak dapat membatalkan booking.", "error");
          }
        })
        .catch(err => {
          console.error(err);
          btn.disabled = false;
          btn.textContent = "Ya, Batalkan";
          Swal.fire("Error", "Terjadi kesalahan di server.", "error");
        });
      }
    });
  });
});
</script>

<style>
/* CSS tambahan agar lebih smooth */
button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
</style>
{% endblock content %}
